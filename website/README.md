# Website Integration

This directory contains files for integrating the conference listings into the EconBase website.

## Structure

- `data/` - Generated JSON files (populated by R scripts)
- `privacy.html` - GDPR-compliant privacy policy
- Example integration code (see below)

## Data Files

### conferences.json

Generated by `api/get-conferences.R`. Updated automatically on schedule.

**Format:**
```json
[
  {
    "name": "Conference Name",
    "start_date": "2025-06-15",
    "end_date": "2025-06-17",
    "location": "Chicago, USA",
    "url": "https://example.com",
    "description": "Brief description...",
    "submission_deadline": "2025-03-01"
  }
]
```

All dates are in ISO 8601 format (YYYY-MM-DD). The `end_date` and `submission_deadline` fields may be `null` if not provided.

## Integration Examples

### Simple HTML + JavaScript

```html
<!DOCTYPE html>
<html>
<head>
    <title>Upcoming Conferences</title>
    <style>
        .conference {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
        }
        .conference h3 {
            margin-top: 0;
        }
        .conference-meta {
            color: #666;
            margin: 10px 0;
        }
        .deadline {
            color: #c00;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Upcoming Conferences and Workshops</h1>

    <p>
        Submit your conference: <a href="GOOGLE_FORM_URL_HERE">Submit Conference</a>
    </p>

    <div id="conferences">Loading...</div>

    <script>
    fetch('/data/conferences.json')
        .then(response => response.json())
        .then(conferences => {
            const container = document.getElementById('conferences');

            if (conferences.length === 0) {
                container.innerHTML = '<p>No upcoming conferences at this time.</p>';
                return;
            }

            const html = conferences.map(conf => {
                const dateRange = conf.end_date
                    ? `${conf.start_date} to ${conf.end_date}`
                    : conf.start_date;

                const deadline = conf.submission_deadline
                    ? `<p class="deadline">Submission deadline: ${conf.submission_deadline}</p>`
                    : '';

                return `
                    <div class="conference">
                        <h3><a href="${conf.url}" target="_blank">${conf.name}</a></h3>
                        <div class="conference-meta">
                            <strong>Date:</strong> ${dateRange}<br>
                            <strong>Location:</strong> ${conf.location}
                        </div>
                        <p>${conf.description}</p>
                        ${deadline}
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        })
        .catch(error => {
            console.error('Error loading conferences:', error);
            document.getElementById('conferences').innerHTML =
                '<p>Error loading conferences. Please try again later.</p>';
        });
    </script>
</body>
</html>
```

### React Component Example

```jsx
import React, { useState, useEffect } from 'react';

function ConferenceList() {
    const [conferences, setConferences] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        fetch('/data/conferences.json')
            .then(res => res.json())
            .then(data => {
                setConferences(data);
                setLoading(false);
            })
            .catch(err => {
                setError(err.message);
                setLoading(false);
            });
    }, []);

    if (loading) return <div>Loading conferences...</div>;
    if (error) return <div>Error: {error}</div>;
    if (conferences.length === 0) return <div>No upcoming conferences.</div>;

    return (
        <div className="conference-list">
            {conferences.map((conf, idx) => (
                <div key={idx} className="conference">
                    <h3>
                        <a href={conf.url} target="_blank" rel="noopener noreferrer">
                            {conf.name}
                        </a>
                    </h3>
                    <p>
                        <strong>Date:</strong>{' '}
                        {conf.end_date
                            ? `${conf.start_date} to ${conf.end_date}`
                            : conf.start_date}
                    </p>
                    <p><strong>Location:</strong> {conf.location}</p>
                    <p>{conf.description}</p>
                    {conf.submission_deadline && (
                        <p className="deadline">
                            Submission deadline: {conf.submission_deadline}
                        </p>
                    )}
                </div>
            ))}
        </div>
    );
}

export default ConferenceList;
```

### Server-Side Rendering (Example: Express/Node)

```javascript
const express = require('express');
const fs = require('fs').promises;
const app = express();

app.get('/conferences', async (req, res) => {
    try {
        const data = await fs.readFile('./website/data/conferences.json', 'utf8');
        const conferences = JSON.parse(data);

        res.render('conferences', { conferences });
    } catch (error) {
        console.error('Error reading conferences:', error);
        res.status(500).render('error', {
            message: 'Unable to load conferences'
        });
    }
});
```

## RSS Feed (Optional)

If you want to provide an RSS feed, modify `api/get-conferences.R` to also generate an XML file:

```r
library(xml2)
library(glue)

# After generating conferences JSON, also create RSS
rss_items <- conferences %>%
  head(20) %>%
  mutate(
    item_xml = glue('
      <item>
        <title>{name}</title>
        <description>{description}</description>
        <link>{url}</link>
        <pubDate>{format(Sys.time(), "%a, %d %b %Y %H:%M:%S GMT")}</pubDate>
        <category>Conference</category>
      </item>
    ')
  ) %>%
  pull(item_xml) %>%
  paste(collapse = "\n")

rss_doc <- glue('<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>EconBase Conferences</title>
    <link>https://econbase.org/conferences</link>
    <description>Upcoming conferences and workshops in econometrics</description>
    <language>en-us</language>
    {rss_items}
  </channel>
</rss>')

writeLines(rss_doc, "../website/conferences.rss")
```

Then add to your HTML:
```html
<link rel="alternate" type="application/rss+xml"
      title="EconBase Conferences"
      href="/conferences.rss">
```

## Privacy Policy

The `privacy.html` file must be accessible and linked from:
1. The Google Form header
2. Any page displaying conference listings
3. Footer navigation

Key privacy points to communicate:
- Email addresses are collected for verification only
- Emails are not publicly displayed
- Data is retained for 12 months after conference date
- Users can request deletion at any time
- Processed by Google (covered under Google's DPA)

## Caching Considerations

The `conferences.json` file is updated on a schedule (e.g., hourly). Consider:

1. **HTTP caching headers** (if serving from static host):
```
Cache-Control: public, max-age=3600
```

2. **CDN configuration** (if using a CDN):
   - Cache the JSON file for the same duration as your update schedule
   - Example: Cloudflare cache TTL = 1 hour

3. **Client-side caching**:
   - Store in localStorage with timestamp
   - Refresh if older than 1 hour
   - Reduces unnecessary fetches for returning visitors

## Testing

Test the integration:

```bash
# Serve locally (Python 3)
cd website
python3 -m http.server 8000

# Visit http://localhost:8000
```

Or with Node:
```bash
npx http-server website -p 8000
```

Check that:
- Conferences display correctly
- Links work
- Dates format properly
- Empty state shows when no conferences
- Privacy policy is accessible

## Analytics (Optional)

Consider tracking:
- Conference link clicks (to see which events are popular)
- Form submission rate
- Time from submission to approval

This can help evaluate the service and improve it over time.

## Troubleshooting

### JSON not loading
- Check file path is correct relative to HTML
- Verify R script ran successfully
- Check browser console for CORS errors

### CORS errors (local development)
- Use a local server, don't open HTML file directly
- Or configure CORS headers on your server

### Stale data
- Verify R script is running on schedule
- Check last modified time: `ls -l data/conferences.json`
- Manually run: `Rscript ../api/get-conferences.R`

## Future Enhancements

Potential features to add:
- Search/filter functionality
- Calendar view
- iCal export (.ics file per conference)
- Tag/category filtering
- Map view of locations
- Email digest subscription
